---
// src/pages/index.astro (ìµœì‹  ê¸€ ì„¹ì…˜ ì¶”ê°€ ìµœì¢…ë³¸)
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import { projects } from '../data/projects';
import PostCard from '../components/PostCard.astro'; // ë¸”ë¡œê·¸ ì¹´ë“œ import ì¶”ê°€!
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

const featuredProjects = projects.filter(p => p.isFeatured && p.image);

// ë¸”ë¡œê·¸ ìµœì‹  ê¸€ 4ê°œë¥¼ ê°€ì ¸ì˜¤ëŠ” ë¡œì§ ì¶”ê°€
const latestPosts = (await getCollection('blog').catch(() => []) ?? [])
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 4);
---
<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
  {/* --- ê¸°ì¡´ ë°°ë„ˆ, ê²€ìƒ‰, í”„ë¡œì íŠ¸ ëª©ë¡ ì„¹ì…˜ (ì´í•˜ ë™ì¼) --- */}
  {featuredProjects.length > 0 && (
    <section class="swiper main-banner">
      <div class="swiper-wrapper">
        {featuredProjects.map(project => (
          <div class="swiper-slide banner-slide" data-id={project.id}>
            <div class="group relative w-full h-[50vh] max-h-[500px] overflow-hidden bg-dark-background cursor-pointer">
              <img src={project.image} alt={project.title} class="absolute w-full h-full object-cover opacity-40 group-hover:opacity-60 group-hover:scale-105 transition-all duration-500"/>
              <div class="absolute inset-0 flex flex-col justify-center items-center text-center text-white p-6">
                <h2 class="text-4xl md:text-6xl font-black mb-4 drop-shadow-lg">{project.title}</h2>
                <p class="text-lg md:text-xl max-w-2xl drop-shadow-lg mb-6">{project.description}</p>
                <span class="px-8 py-3 bg-accent text-white font-bold rounded-full shadow-lg group-hover:bg-accent-hover transition-colors">ìì„¸íˆ ë³´ê¸° &rarr;</span>
              </div>
            </div>
          </div>
        ))}
      </div>
      <div class="swiper-button-prev"></div><div class="swiper-button-next"></div><div class="swiper-pagination"></div>
    </section>
  )}

  <section id="project-section" class="max-w-7xl mx-auto px-6 py-16">
    <div class="mb-12">
      <div class="relative max-w-2xl mx-auto">
        <input type="text" id="search-input" placeholder="ì˜ˆ: MBTI, ì‹¬ë¦¬í…ŒìŠ¤íŠ¸, í€´ì¦ˆ..." class="w-full px-6 py-4 border-2 border-border rounded-full bg-surface focus:outline-none focus:ring-2 focus:ring-accent"/>
        <svg class="absolute right-6 top-1/2 -translate-y-1/2 w-6 h-6 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" /></svg>
      </div>
    </div>
    <div id="project-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      {projects.map(project => (
        <button type="button" class="project-card group block bg-surface rounded-2xl border-2 border-transparent hover:border-accent hover:shadow-xl transition-all duration-300 p-6 text-left" data-id={project.id} data-title={project.title.toLowerCase()} data-description={project.description.toLowerCase()} data-category={project.category.toLowerCase()}>
          <span class="text-xs font-semibold text-accent bg-blue-100/50 px-2 py-1 rounded-full">{project.category}</span>
          <h3 class="text-xl font-bold text-primary mt-3 mb-2">{project.title}</h3>
          <p class="text-sm text-secondary line-clamp-3 h-[60px]">{project.description}</p>
        </button>
      ))}
    </div>
    <p id="no-results" class="text-center text-secondary py-16 hidden">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ğŸ˜¥</p>
    <nav id="pagination-controls" class="flex justify-center items-center space-x-4 my-12 text-lg">
      <button id="prev-page" class="px-5 py-2.5 bg-surface rounded-lg shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">ì´ì „</button>
      <span id="page-info" class="font-semibold text-secondary"></span>
      <button id="next-page" class="px-5 py-2.5 bg-surface rounded-lg shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed">ë‹¤ìŒ</button>
    </nav>
  </section>

  {/* â–¼â–¼â–¼ 'ì½˜í…ì¸  ì—†ìŒ' ë°©ì§€ë¥¼ ìœ„í•œ ìµœì‹  ê¸€ ì„¹ì…˜ ì¶”ê°€ â–¼â–¼â–¼ */}
  {latestPosts.length > 0 && (
    <section class="max-w-7xl mx-auto px-6 py-16 border-t border-border">
      <div class="text-center mb-12">
          <h2 class="text-3xl font-bold">ìµœì‹  ë¸”ë¡œê·¸ ì†Œì‹</h2>
          <a href="/blog" class="text-accent hover:underline mt-2 inline-block">ì „ì²´ ê¸€ ë³´ê¸° &rarr;</a>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
        {latestPosts.map(post => (
          // PostCard ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¼ê´€ëœ ë””ìì¸ ìœ ì§€
          <div class="bg-surface rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 overflow-hidden group">
            <a href={`/blog/${post.slug}`}>
              {post.data.heroImage && (
                <div class="overflow-hidden h-40">
                  <img src={post.data.heroImage} alt={post.data.heroImageAlt || post.data.title} class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
                </div>
              )}
              <div class="p-6">
                <h3 class="text-lg font-bold text-primary mb-2 line-clamp-2 h-14">{post.data.title}</h3>
                <p class="text-sm text-secondary">{new Date(post.data.pubDate).toLocaleDateString('ko-KR')}</p>
              </div>
            </a>
          </div>
        ))}
      </div>
    </section>
  )}

  {/* --- ì´í•˜ ëª¨ë‹¬ ë° ìŠ¤í¬ë¦½íŠ¸ (ì´ì „ ìµœì¢…ë³¸ê³¼ ë™ì¼) --- */}
  <div id="project-modal" class="...">{/* ... */}</div>
</BaseLayout>
<script is:inline src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script define:vars={{ projects }}>
    document.addEventListener('astro:page-load', () => { /* ... ì´ì „ ìµœì¢…ë³¸ê³¼ ë™ì¼ */ });
</script>